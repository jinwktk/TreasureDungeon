TreasureDungeon.luaとして最新版で動作するように、作り直しましょう。

流れとしては、以下になります。

地図購入Phase
地図を持っているかどうか確認。
持っていなかったらマーケットボードで購入し、ディサイファーを行いFlag先へテレポート
持っていたらディグをしてFlag先にテレポート

移動Phase
テレポートを終えたら、Flag先までvnavmeshで移動
移動が完了したら、ディグを行う。
宝箱がターゲットできたら、宝箱に向けて移動し、インタラクト。

ダンジョン外戦闘Phase
戦闘開始したらRSRとBMRをONにする。
戦闘完了したら、転送魔紋の確認。
存在したらインタラクトして、Dungeonに申請。
存在していなかったら、地図購入Phaseへ戻る。

ダンジョンPhase
ダンジョンはいったら、タイプ確認。
召喚魔法陣が存在したらルーレットタイプ
しなかったら、ダンジョンタイプ

ダンジョンタイプ
オートランで前へ進み、宝箱がターゲットできたら、宝箱に向けて移動し、インタラクト。
※最終層のみ敵がいるので、その場合はゴールデン・モルターかブルアポリオンをターゲットし戦闘開始する。今後追加します。
戦闘開始したらRSRとBMRをONにする。
戦闘完了したら、宝箱と皮袋に向けて移動しインタラクト。
宝箱と皮袋がなくなったら、宝物庫の扉に向けて移動し、インタラクト。
最終層は、脱出地点に向けて移動しインタラクト

ルーレットタイプ
召喚魔法陣に向けて移動し、インタラクト
戦闘開始したらRSRとBMRをONにする。
戦闘完了したら、宝箱と皮袋に向けて移動しインタラクト。
宝箱と皮袋がなくなったら、召喚魔法陣に向けて移動し、インタラクト。
最終層は、脱出地点に向けて移動しインタラクト

双方、ダンジョンから追い出されたら、地図購入Phaseへ戻る。
適宜、装備の修理、チョコボの召喚、食事の更新は行うこととする。

コードを作成する際に以下のソースコードを参考にすると解決するかもしれません。
https://github.com/Jaksuhn/SomethingNeedDoing
https://github.com/WigglyMuffin/SNDScripts/
https://github.com/McVaxius/dhogsbreakfeast
https://github.com/pot0to/pot0to-SND-Scripts/tree/main/New%20SND

特に、以下のコードが一番参考になると思います。
https://github.com/McVaxius/dhogsbreakfeast/blob/main/_functions.lua